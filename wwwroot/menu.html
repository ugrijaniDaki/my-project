<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura | Menu</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Inter:wght@200;300;400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        body.modal-open { overflow: hidden; }
        .font-serif { font-family: 'Playfair Display', serif; }

        .fade-in { animation: fadeIn 0.8s ease forwards; opacity: 0; }
        .fade-in-delay-1 { animation-delay: 0.15s; }
        .fade-in-delay-2 { animation-delay: 0.3s; }
        .fade-in-delay-3 { animation-delay: 0.45s; }

        @keyframes fadeIn { to { opacity: 1; } }

        .menu-item:hover .menu-image { transform: scale(1.05); }

        /* Flying item animation - arc trajectory */
        .flying-item {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #d4af37, #b8963a);
            color: white;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.5);
        }

        /* Cart button pulse */
        @keyframes cartPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .cart-pulse { animation: cartPulse 0.3s ease; }

        /* Modal styles - FIXED positioning for blur */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-y: auto;
            overscroll-behavior: contain;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .modal-content {
            position: relative;
            z-index: 1;
            max-height: calc(100vh - 2rem);
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .modal-enter { animation: modalEnter 0.3s ease; }
        @keyframes modalEnter {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Gold accent */
        .gold-gradient { background: linear-gradient(135deg, #d4af37, #f4d03f); }
        .text-gold { color: #d4af37; }

        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 2px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 2px; }

        /* Input focus */
        .input-elegant:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
    </style>
</head>
<body class="bg-[#fafaf9] text-stone-800 antialiased">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 flex justify-between items-center px-8 py-6 bg-[#fafaf9]/95 backdrop-blur-sm border-b border-stone-100">
        <a href="index.html" class="text-xl tracking-[0.5em] uppercase font-light text-stone-800">Aura</a>
        <div class="flex items-center gap-8">
            <div class="space-x-8 text-[10px] uppercase tracking-[0.2em]">
                <a href="index.html" class="text-stone-400 hover:text-stone-800 transition">Pocetna</a>
                <a href="menu.html" class="text-stone-800 border-b border-stone-800 pb-1">Menu</a>
                <a href="reservation.html" class="text-stone-400 hover:text-stone-800 transition">Rezervacija</a>
                <a href="contact.html" class="text-stone-400 hover:text-stone-800 transition">Kontakt</a>
            </div>
        </div>
    </nav>

    <!-- Floating Cart Button -->
    <button onclick="openCart()" id="cartButton" class="fixed bottom-8 right-8 z-40 bg-stone-900 text-white w-14 h-14 rounded-full shadow-2xl hover:bg-stone-800 transition-all flex items-center justify-center group">
        <svg class="w-6 h-6 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <span id="cartCount" class="absolute -top-1 -right-1 w-6 h-6 gold-gradient text-stone-900 text-xs rounded-full flex items-center justify-center font-bold shadow-lg hidden">0</span>
    </button>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal-overlay">
        <div class="modal-backdrop" onclick="closeCart()"></div>
        <div class="modal-content modal-enter bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <!-- Header with back button -->
            <div class="p-6 pb-2">
                <button onclick="closeCart()" class="w-10 h-10 rounded-full bg-stone-100 hover:bg-stone-200 transition flex items-center justify-center">
                    <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
            </div>

            <!-- Title -->
            <div class="text-center px-8 pb-6">
                <h2 class="text-xl tracking-[0.3em] uppercase text-stone-800 font-medium">Košarica</h2>
                <p id="cartItemCount" class="text-stone-400 text-sm mt-2">Vaša narudžba</p>
            </div>

            <!-- Cart Content -->
            <div class="px-8 pb-8 max-h-[50vh] overflow-y-auto custom-scroll">
                <!-- Empty state -->
                <div id="cartEmpty" class="py-12 text-center">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-stone-100 flex items-center justify-center">
                        <svg class="w-8 h-8 text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                        </svg>
                    </div>
                    <p class="text-stone-400">Košarica je prazna</p>
                </div>

                <!-- Cart Items -->
                <div id="cartItems" class="space-y-3 hidden"></div>
            </div>

            <!-- Footer -->
            <div id="cartFooter" class="px-8 pb-8 hidden">
                <div class="flex justify-between items-center py-4 border-t border-stone-100 mb-4">
                    <span class="text-stone-500">Ukupno</span>
                    <span id="cartTotal" class="text-2xl font-medium text-stone-800">0 €</span>
                </div>
                <button onclick="proceedToCheckout()" class="w-full bg-stone-900 text-white py-4 rounded-2xl font-medium tracking-wider uppercase text-sm hover:bg-stone-800 transition">
                    Nastavi na narudžbu
                </button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal-overlay">
        <div class="modal-backdrop" onclick="closeCheckoutModal()"></div>
        <div class="modal-content modal-enter bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <!-- Header with back button -->
            <div class="p-6 pb-2">
                <button onclick="closeCheckoutModal(); setTimeout(() => openCart(), 200);" class="w-10 h-10 rounded-full bg-stone-100 hover:bg-stone-200 transition flex items-center justify-center">
                    <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
            </div>

            <!-- Title -->
            <div class="text-center px-8 pb-6">
                <h2 class="text-xl tracking-[0.3em] uppercase text-stone-800 font-medium">Dostava</h2>
                <p class="text-stone-400 text-sm mt-2">Unesite podatke za dostavu</p>
            </div>

            <form id="checkoutForm" class="px-8 pb-8" onsubmit="handleCheckout(event)">
                <!-- Contact Fields -->
                <div class="space-y-4">
                    <input type="text" id="deliveryFirstName" required placeholder="Ime"
                        class="w-full px-5 py-4 bg-stone-100 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-stone-300 transition text-stone-700 placeholder-stone-400">

                    <input type="text" id="deliveryLastName" required placeholder="Prezime"
                        class="w-full px-5 py-4 bg-stone-100 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-stone-300 transition text-stone-700 placeholder-stone-400">

                    <input type="tel" id="deliveryPhone" required placeholder="Telefon"
                        class="w-full px-5 py-4 bg-stone-100 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-stone-300 transition text-stone-700 placeholder-stone-400">

                    <input type="text" id="deliveryAddress" required placeholder="Adresa dostave"
                        class="w-full px-5 py-4 bg-stone-100 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-stone-300 transition text-stone-700 placeholder-stone-400">

                    <textarea id="deliveryNotes" rows="2" placeholder="Napomena (opcionalno)"
                        class="w-full px-5 py-4 bg-stone-100 border-0 rounded-2xl focus:outline-none focus:ring-2 focus:ring-stone-300 transition text-stone-700 placeholder-stone-400 resize-none"></textarea>
                </div>

                <!-- Order Summary -->
                <div class="mt-6 p-4 bg-stone-50 rounded-2xl">
                    <div class="flex items-center justify-between text-sm text-stone-500 mb-3">
                        <span>Vaša narudžba</span>
                        <span id="checkoutItemCount"></span>
                    </div>
                    <div id="checkoutItems" class="space-y-1 text-sm text-stone-600 mb-3 max-h-24 overflow-y-auto"></div>
                    <div class="border-t border-stone-200 pt-3 flex justify-between items-center">
                        <span class="text-stone-600 font-medium">Ukupno</span>
                        <span id="checkoutTotal" class="text-lg font-medium text-stone-800"></span>
                    </div>
                </div>

                <div id="checkoutError" class="mt-4 p-3 bg-red-50 text-red-600 text-sm rounded-xl hidden"></div>

                <button type="submit" class="w-full bg-stone-900 text-white py-4 rounded-2xl font-medium tracking-wider uppercase text-sm mt-6 hover:bg-stone-800 transition">
                    Potvrdi narudžbu
                </button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-enter bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden">
            <div class="p-8 text-center">
                <div class="w-16 h-16 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                </div>
                <h3 class="text-xl tracking-[0.2em] uppercase text-stone-800 font-medium mb-3">Hvala vam!</h3>
                <p class="text-stone-400 text-sm mb-8">Vaša narudžba je uspješno zaprimljena.<br>Uskoro ćemo vas kontaktirati.</p>
                <button onclick="closeSuccessModal()" class="w-full bg-stone-900 text-white py-4 rounded-2xl font-medium tracking-wider uppercase text-sm hover:bg-stone-800 transition">
                    U redu
                </button>
            </div>
        </div>
    </div>

    <main class="pt-32 pb-20">
        <!-- Hero Section -->
        <header class="text-center mb-20 px-8 fade-in">
            <p class="text-[10px] uppercase tracking-[0.5em] text-stone-400 mb-4">Sezona 2026</p>
            <h1 class="text-5xl md:text-6xl font-serif italic mb-6">Degustacijski Menu</h1>
            <div class="w-20 h-[1px] bg-gradient-to-r from-transparent via-stone-300 to-transparent mx-auto"></div>
            <p class="text-stone-500 text-sm mt-8 max-w-lg mx-auto leading-relaxed">
                Sedam sljedova koji slave lokalnu zemlju, more i tradiciju.
                Svaki tanjur priča svoju priču kroz pažljivo odabrane namirnice.
            </p>
        </header>

        <!-- Featured Image -->
        <div class="max-w-5xl mx-auto px-8 mb-24 fade-in fade-in-delay-1">
            <div class="relative h-[400px] rounded-3xl overflow-hidden shadow-2xl">
                <img src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&q=80&w=2070"
                     class="w-full h-full object-cover" alt="Fine Dining Experience">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                <div class="absolute bottom-8 left-8 text-white">
                    <p class="text-[10px] uppercase tracking-[0.3em] opacity-80 mb-2">Dostava dostupna</p>
                    <p class="text-2xl font-serif italic">Naručite svoja omiljena jela</p>
                </div>
            </div>
        </div>

        <!-- Menu Items - Dynamic -->
        <div id="menuContainer" class="max-w-4xl mx-auto px-8">
            <div class="text-center py-12 text-stone-400">Učitavanje menija...</div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-16 text-center border-t border-stone-100">
        <p class="text-xl font-serif tracking-[0.3em] text-stone-300 mb-4">AURA</p>
        <p class="text-stone-400 text-sm">Trg Kralja Tomislava 1, Zagreb</p>
        <p class="text-stone-400 text-sm mt-1">Utorak - Subota, 18:00 - 00:00</p>
    </footer>

    <script>
        let cart = JSON.parse(localStorage.getItem('auraCart') || '[]');
        let menuItems = [];

        const categoryNames = {
            'Appetizer': 'Predjela',
            'Soup': 'Juhe',
            'Salad': 'Salate',
            'Pasta': 'Tjestenine',
            'Fish': 'Riba',
            'Meat': 'Meso',
            'Dessert': 'Deserti',
            'Beverage': 'Pića',
            'Special': 'Specijalitet'
        };

        const categoryOrder = ['Appetizer', 'Soup', 'Salad', 'Pasta', 'Fish', 'Meat', 'Dessert', 'Beverage', 'Special'];

        document.addEventListener('DOMContentLoaded', () => {
            loadMenu();
            updateCartUI();
        });

        async function loadMenu() {
            try {
                const response = await fetch('/api/menu');
                menuItems = await response.json();
                renderMenu();
            } catch (error) {
                document.getElementById('menuContainer').innerHTML = '<div class="text-center py-12 text-red-400">Greška pri učitavanju menija</div>';
            }
        }

        function renderMenu() {
            const container = document.getElementById('menuContainer');
            const grouped = {};

            menuItems.forEach(item => {
                if (!grouped[item.category]) grouped[item.category] = [];
                grouped[item.category].push(item);
            });

            let html = '';
            categoryOrder.forEach(category => {
                if (!grouped[category] || grouped[category].length === 0) return;

                html += `
                    <section class="mb-16 fade-in">
                        <div class="flex items-center gap-4 mb-10">
                            <div class="h-[1px] flex-1 bg-stone-200"></div>
                            <h2 class="text-[11px] uppercase tracking-[0.4em] text-stone-400">${categoryNames[category] || category}</h2>
                            <div class="h-[1px] flex-1 bg-stone-200"></div>
                        </div>
                        <div class="space-y-8">
                `;

                grouped[category].forEach(item => {
                    html += `
                        <div class="menu-item grid md:grid-cols-[1fr,140px] gap-6 pb-8 border-b border-stone-100" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}">
                            <div>
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-lg font-serif">${item.name}</h3>
                                    <span class="text-lg text-gold font-medium">${item.price.toFixed(2)} €</span>
                                </div>
                                <p class="text-stone-400 text-sm leading-relaxed mb-4">${item.description || ''}</p>
                                <button onclick="addToCart(this)" class="add-btn group flex items-center gap-2 px-4 py-2 border border-stone-200 text-stone-600 text-sm rounded-full hover:border-gold hover:text-gold transition">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    Dodaj
                                </button>
                            </div>
                            ${item.imageUrl ? `
                            <div class="h-28 md:h-auto rounded-xl overflow-hidden">
                                <img src="${item.imageUrl}" class="menu-image w-full h-full object-cover transition-transform duration-500" alt="${item.name}">
                            </div>
                            ` : ''}
                        </div>
                    `;
                });

                html += `</div></section>`;
            });

            container.innerHTML = html;
        }

        // Flying animation with arc trajectory
        function addToCart(btn) {
            const menuItem = btn.closest('.menu-item');
            const id = parseInt(menuItem.dataset.id);
            const name = menuItem.dataset.name;
            const price = parseFloat(menuItem.dataset.price);

            // Add to cart data
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            localStorage.setItem('auraCart', JSON.stringify(cart));

            // Create flying element
            const btnRect = btn.getBoundingClientRect();
            const cartBtn = document.getElementById('cartButton');
            const cartRect = cartBtn.getBoundingClientRect();

            const flyingEl = document.createElement('div');
            flyingEl.className = 'flying-item';
            flyingEl.textContent = '+1';
            flyingEl.style.left = (btnRect.left + btnRect.width / 2 - 18) + 'px';
            flyingEl.style.top = (btnRect.top - 10) + 'px';
            document.body.appendChild(flyingEl);

            // Calculate positions
            const startX = btnRect.left + btnRect.width / 2 - 18;
            const startY = btnRect.top - 10;
            const endX = cartRect.left + cartRect.width / 2 - 18;
            const endY = cartRect.top + cartRect.height / 2 - 18;

            // Arc animation - jump up first, then curve to cart
            let startTime = null;
            const duration = 1200; // Slower animation (1.2 seconds)

            function animate(currentTime) {
                if (!startTime) startTime = currentTime;
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing function for smooth movement
                const easeOutCubic = 1 - Math.pow(1 - progress, 3);

                // Calculate position along arc
                // First phase (0-0.3): jump up
                // Second phase (0.3-1): curve to cart
                let x, y, scale, opacity;

                if (progress < 0.3) {
                    // Jump UP phase
                    const jumpProgress = progress / 0.3;
                    const jumpEase = 1 - Math.pow(1 - jumpProgress, 2);
                    x = startX;
                    y = startY - (80 * jumpEase); // Jump 80px up
                    scale = 1 + (0.1 * jumpEase); // Slight scale up
                    opacity = 1;
                } else {
                    // Arc to cart phase
                    const arcProgress = (progress - 0.3) / 0.7;
                    const arcEase = 1 - Math.pow(1 - arcProgress, 2);

                    const peakY = startY - 80; // Starting from top of jump

                    // Bezier curve calculation
                    const controlX = startX + (endX - startX) * 0.5;
                    const controlY = Math.min(peakY, endY) - 100; // Arc peak above both points

                    // Quadratic bezier
                    const t = arcEase;
                    x = Math.pow(1-t, 2) * startX + 2 * (1-t) * t * controlX + Math.pow(t, 2) * endX;
                    y = Math.pow(1-t, 2) * peakY + 2 * (1-t) * t * controlY + Math.pow(t, 2) * endY;

                    scale = 1.1 - (0.7 * arcEase); // Scale down as it approaches
                    opacity = 1 - (0.3 * arcEase);
                }

                flyingEl.style.left = x + 'px';
                flyingEl.style.top = y + 'px';
                flyingEl.style.transform = `scale(${scale})`;
                flyingEl.style.opacity = opacity;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Animation complete
                    cartBtn.classList.add('cart-pulse');
                    setTimeout(() => cartBtn.classList.remove('cart-pulse'), 300);
                    flyingEl.remove();
                    updateCartUI();
                }
            }

            requestAnimationFrame(animate);

            // Button feedback
            btn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Dodano`;
            btn.classList.add('border-green-500', 'text-green-600');
            setTimeout(() => {
                btn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg> Dodaj`;
                btn.classList.remove('border-green-500', 'text-green-600');
            }, 1500);
        }

        function updateCartUI() {
            const countEl = document.getElementById('cartCount');
            const emptyEl = document.getElementById('cartEmpty');
            const itemsEl = document.getElementById('cartItems');
            const footerEl = document.getElementById('cartFooter');
            const totalEl = document.getElementById('cartTotal');
            const itemCountEl = document.getElementById('cartItemCount');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (totalItems > 0) {
                countEl.textContent = totalItems;
                countEl.classList.remove('hidden');
            } else {
                countEl.classList.add('hidden');
            }

            itemCountEl.textContent = `${totalItems} artikala`;

            if (cart.length === 0) {
                emptyEl.classList.remove('hidden');
                itemsEl.classList.add('hidden');
                footerEl.classList.add('hidden');
            } else {
                emptyEl.classList.add('hidden');
                itemsEl.classList.remove('hidden');
                footerEl.classList.remove('hidden');

                itemsEl.innerHTML = cart.map((item, index) => `
                    <div class="flex items-center gap-3 p-4 bg-stone-100 rounded-2xl">
                        <div class="flex-1 min-w-0">
                            <h4 class="font-medium text-stone-700 text-sm truncate">${item.name}</h4>
                            <p class="text-stone-400 text-sm">${item.price.toFixed(2)} €</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateQuantity(${index}, -1)" class="w-8 h-8 rounded-full bg-white hover:bg-stone-200 transition flex items-center justify-center text-stone-600 text-lg">−</button>
                            <span class="w-6 text-center font-medium text-stone-700">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="w-8 h-8 rounded-full bg-white hover:bg-stone-200 transition flex items-center justify-center text-stone-600 text-lg">+</button>
                        </div>
                        <button onclick="removeFromCart(${index})" class="w-8 h-8 rounded-full hover:bg-red-100 transition flex items-center justify-center text-stone-400 hover:text-red-500">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `).join('');

                totalEl.textContent = `${totalPrice.toFixed(2)} €`;
            }
        }

        function updateQuantity(index, delta) {
            cart[index].quantity += delta;
            if (cart[index].quantity <= 0) cart.splice(index, 1);
            localStorage.setItem('auraCart', JSON.stringify(cart));
            updateCartUI();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('auraCart', JSON.stringify(cart));
            updateCartUI();
        }

        function openCart() {
            document.getElementById('cartModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        function proceedToCheckout() {
            if (cart.length === 0) return;
            closeCart();
            setTimeout(() => openCheckoutModal(), 200);
        }

        function openCheckoutModal() {
            const modal = document.getElementById('checkoutModal');
            document.body.classList.add('modal-open');

            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            document.getElementById('checkoutItems').innerHTML = cart.map(item => `
                <div class="flex justify-between">
                    <span class="text-stone-600">${item.quantity}× ${item.name}</span>
                    <span class="text-stone-500">${(item.price * item.quantity).toFixed(2)} €</span>
                </div>
            `).join('');

            document.getElementById('checkoutTotal').textContent = `${totalPrice.toFixed(2)} €`;
            document.getElementById('checkoutItemCount').textContent = `${totalItems} artikala`;

            modal.classList.add('active');
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }

        async function handleCheckout(event) {
            event.preventDefault();
            const errorEl = document.getElementById('checkoutError');
            errorEl.classList.add('hidden');

            const orderData = {
                customerName: document.getElementById('deliveryFirstName').value + ' ' + document.getElementById('deliveryLastName').value,
                deliveryAddress: document.getElementById('deliveryAddress').value,
                phone: document.getElementById('deliveryPhone').value,
                notes: document.getElementById('deliveryNotes').value,
                items: cart.map(item => ({
                    menuItemId: item.id,
                    quantity: item.quantity,
                    notes: ''
                }))
            };

            try {
                const response = await fetch('/api/orders/guest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                const data = await response.json();
                if (!response.ok) {
                    errorEl.textContent = data.error || 'Greška pri narudžbi';
                    errorEl.classList.remove('hidden');
                    return;
                }
                cart = [];
                localStorage.setItem('auraCart', JSON.stringify(cart));
                updateCartUI();
                closeCheckoutModal();
                setTimeout(() => openSuccessModal(), 200);
            } catch (error) {
                errorEl.textContent = 'Greška pri povezivanju';
                errorEl.classList.remove('hidden');
            }
        }

        function openSuccessModal() {
            document.getElementById('successModal').classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            document.body.classList.remove('modal-open');
        }
    </script>
</body>
</html>
