import{H as p,m as h}from"./chunk-HHGIFYPJ.js";import{A as s,Q as r,U as d,V as c,Y as b,fb as m,h as l,l as n,q as o}from"./chunk-4TCHIV6K.js";var _=class a{constructor(t){this.http=t;this.loadSavedSession()}baseUrl="https://my-project-r5ce.onrender.com";TOKEN_KEY="authToken";USER_KEY="authUser";currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();isLoggedIn$=this.currentUser$.pipe(o(t=>!!t));loadSavedSession(){let t=localStorage.getItem(this.TOKEN_KEY),e=localStorage.getItem(this.USER_KEY);if(t&&e)try{let i=JSON.parse(e);this.currentUserSubject.next(i),this.verifyToken().subscribe()}catch{this.clearSession()}}getToken(){return localStorage.getItem(this.TOKEN_KEY)}get currentUser(){return this.currentUserSubject.value}register(t){return this.http.post(`${this.baseUrl}/api/auth/register`,t).pipe(r(e=>this.saveSession(e)))}login(t,e){return this.http.post(`${this.baseUrl}/api/auth/login`,{email:t,password:e}).pipe(r(i=>this.saveSession(i)))}logout(){let t=this.getToken();return t?this.http.post(`${this.baseUrl}/api/auth/logout`,{},{headers:{Authorization:`Bearer ${t}`}}).pipe(r(()=>this.clearSession()),s(()=>(this.clearSession(),n(void 0)))):(this.clearSession(),n(void 0))}verifyToken(){let t=this.getToken();return t?this.http.get(`${this.baseUrl}/api/auth/verify`,{headers:{Authorization:`Bearer ${t}`}}).pipe(r(e=>{this.currentUserSubject.next(e.user),localStorage.setItem(this.USER_KEY,JSON.stringify(e.user))}),o(()=>!0),s(()=>(this.clearSession(),n(!1)))):n(!1)}saveSession(t){localStorage.setItem(this.TOKEN_KEY,t.token),localStorage.setItem(this.USER_KEY,JSON.stringify(t.user)),this.currentUserSubject.next(t.user)}clearSession(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSubject.next(null)}static \u0275fac=function(e){return new(e||a)(b(h))};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};var ot=(()=>{class a{static \u0275fac=function(i){return new(i||a)};static \u0275mod=m({type:a});static \u0275inj=c({imports:[p]})}return a})();export{ot as a,_ as b};
